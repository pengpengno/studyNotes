---
title: Mysql 单表数据量 以及性能分析
date: 2022-05-12 13:36:19.473
updated: 2022-05-12 13:36:19.473
url: /archives/mysql-dan-biao-shu-ju-liang-yi-ji-xing-neng-fen-xi
categories: 
- 数据库
tags: 
---

## Mysql 单表数据量 以及性能分析
首先来看下B+树
![image-1652333349162](/upload/2022/05/image-1652333349162.png)
### B+树
Mysql 的 B+树索引存储在磁盘上，Mysql 每次读取磁盘[ Page 的⼤⼩是 16KB]，为了保证每次查询的效率，需要保证每次查询访问磁盘
的次数，⼀般设计为 2-3 次磁盘访问，再多性能将严重不⾜。Mysql B+树索引的每个节点需要存储⼀个指针（8Byte）和⼀个键值
（8Byte）。因此计算16KB/(8B+8B)=1K 16KB 可以存储 1K 个节点，3 次磁盘访问(即 B+树 3 的深度)可以存储 1k^3即 10亿数据。
如果查询依赖⾮主键索引，那么还涉及⼆级索引。这样数据量将更⼩。

### 数据解决方案
#### 拆分
分⽽治之——没有什么问题不能通过拆分⼀次来解决，不⾏就拆多次。
Mysql 单表存储的数据量有限。⼀个解决⼤数据量存储的办法就是分库分表。说⽩了就是⼀个数据库⼀张表放不下那么多数据，那就分多个
数据库多张表存储。
拆分可分为垂直拆分和⽔平拆分。
垂直拆分是按照不同的表（或者 Schema）来切分到不同的数据库（主机）之上，⽔平拆分则是根据表中的数据的逻辑关系，将同⼀个表中
的数据按照某种条件拆分到多台数据库（主机）上⾯或多张相同 Schema 的不同表中。
垂直拆分的最⼤特点就是规则简单，实施也更为⽅便，尤其适合各业务之间的耦合度⾮常低，相互影响很⼩，业务逻辑⾮常清晰的系统。在
这种系统中，可以很容易做到将不同业务模块所使⽤的表分拆到不同的数据库中。根据不同的表来进⾏拆分，对应⽤程序的影响也更⼩，拆
分规则也会⽐较简单清晰。
⽔平拆分与垂直切分相⽐，相对来说稍微复杂⼀些。因为要将同⼀个表中的不同数据拆分到不同的数据库中，对于应⽤程序来说，拆分规则
本⾝就较根据表名来拆分更为复杂，后期的数据维护也会更为复杂⼀些。
垂直拆分最直接的就是按领域拆分服务，隔离领域数据库。如此每个库所承担的数据压⼒就减少了。
⽔平拆分就是将同⼀个 Schema 的数据拆分到不同的库或不同的表中，这样每个表的数据量也将减⼩，查询效率将更⾼效。⽔平拆分就涉
及到表的分⽚规则问题。
##### 典型的分⽚规则：
1. 按照⽤户 ID 求模，将数据分散到不同的数据库，具有相同数据⽤户的数据都被分散到⼀个库中。
2. 按照⽇期，将不同⽉甚⾄⽇的数据分散到不同的库中。
3. 按照某个特定的字段求摸，或者根据特定范围段分散到不同的库中。

### 实现
##### 垂直拆分
⼀个⽅案就是在应⽤层使⽤多个数据源，按业务访问不同的数据源。另外更好⽅案其实就是微服务化。按不同的业务领域来拆分
微服务，明确领域边界，隔离领域数据库。这样将对数据的存取内聚到独⽴的服务之中，对外提供统⼀的接⼝。在需要同时依赖多个服务
时，我们可以通过添加门⾯应⽤来组合底层服务的数据，以提供更符合上层业务需求的接⼝，这些服务往往更接近真实的业务。⽽底层的服
务则是更加内聚的资源服务。
##### 代理模式——没有什么问题不能通过添加⼀个中间层来解决。
对于⽔平拆分应该尽量屏蔽拆分带来的数据访问困恼，为了让上层业务⽆需关⼼下层数据组织⽅式。⽔平拆分往往通过添加⼀个代理层来做
这些事情，代理层对上提供虚拟表，这些虚拟表就像我们在单库上设计的单表⼀样；代理层对下解析和拆分执⾏ sql，然后按相应规则在不
同的库和表执⾏相应的 sql 请求，再合并数据，并将合并后的结果返回给上层调⽤者。
⼀般代理⽅式分为如下两种：
进程内代理进程内代理即将代理层嵌⼊到业务服务内部，拦截 sql 请求并做相应的处理。这样的好处是简单，但是侵⼊性⼤，且不够灵活。
![image-1652333498505](/upload/2022/05/image-1652333498505.png)
进程外代理进程外代理即将代理独⽴成服务，代理真实业务服务和数据库之间的请求。这样是⽐较复杂的，需要⾼可⽤的代理服务架构。但是这样对业务的侵⼊性低，且易于升级扩展。
![image-1652333442126](/upload/2022/05/image-1652333442126.png)
